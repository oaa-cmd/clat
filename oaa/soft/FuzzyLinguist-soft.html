<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kmp+</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent: #3498db;
            --accent-hover: #2980b9;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
            --chart-bg: #fafafa;
            --grid-color: #e0e0e0;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #242424;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --accent: #3498db;
            --accent-hover: #5dade2;
            --border: #404040;
            --shadow: rgba(0, 0, 0, 0.3);
            --chart-bg: #1a1a1a;
            --grid-color: #404040;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--bg-card);
            padding: 20px 0;
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: #294f8f;
        }

        .theme-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 10px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .info-button {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--bg-card);
            margin: 50px auto;
            padding: 30px;
            max-width: 800px;
            border-radius: 15px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .step-section {
            background: var(--bg-card);
            padding: 30px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 4px 15px var(--shadow);
            display: none;
        }

        .step-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: clamp(1.3rem, 2.5vw, 1.8rem);
        }

        h3 {
            color: var(--text-primary);
            margin: 20px 0 10px;
            font-size: 1.2rem;
        }

        .input-group {
            margin: 20px 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        input[type="text"], input[type="range"] {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        input[type="range"] {
            padding: 5px;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chart-container {
            background: var(--chart-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            min-height: 300px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        .result-box {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
        }

        .modifier-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .modifier-btn {
            padding: 8px 20px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modifier-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .rule-box {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .progress-bar {
            background: var(--bg-secondary);
            height: 10px;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--accent);
            height: 100%;
            transition: width 0.5s ease;
        }

        .slider-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: var(--accent);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .step-section {
                padding: 20px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .navigation {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }

        .highlight {
            color: var(--accent);
            font-weight: bold;
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1>Fuzzy Linguist</h1>
                <div>
                    <button class="info-button" onclick="toggleInfo()">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 20%"></div>
        </div>

        <!-- Step 0: Welcome -->
        <div class="step-section active" id="step0">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –Ω–µ—á–µ—Ç–∫–æ–π –ª–æ–≥–∏–∫–∏!</h2>
            <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –∫–æ–º–ø—å—é—Ç–µ—Ä –º–æ–∂–µ—Ç –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞.</p>
            <div class="input-group">
                <label for="userName">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –§–∞–º–∏–ª–∏—é –∏ –ò–º—è:</label>
                <input type="text" id="userName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è">
            </div>
            <button onclick="startAnalysis()">–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑!</button>
        </div>

        <!-- Step 1: Crisp vs Fuzzy Logic -->
        <div class="step-section" id="step1">
            <h2>–ú–æ–¥—É–ª—å 1: –ß–µ—Ç–∫–∞—è vs. –ù–µ—á–µ—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞</h2>
            <p>–†–∞–∑–±–µ—Ä–µ–º—Å—è<span class="highlight" id="userGreeting"></span>, –∫–∞–∫ –∫–æ–º–ø—å—é—Ç–µ—Ä –º–æ–∂–µ—Ç "–ø–æ–Ω—è—Ç—å" –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å.</p>
            
            <h3>–ß–µ—Ç–∫–∞—è (–ë—É–ª–µ–≤–∞) –ª–æ–≥–∏–∫–∞</h3>
            <div class="result-box">
                <p><strong>–ü—Ä–∞–≤–∏–ª–æ:</strong> IF (–¥–ª–∏–Ω–∞_–∏–º–µ–Ω–∏ > 15 —Å–∏–º–≤–æ–ª–æ–≤) THEN "–î–ª–∏–Ω–Ω–æ–µ" ELSE "–ö–æ—Ä–æ—Ç–∫–æ–µ"</p>
                <p>–í–∞—à–µ –∏–º—è "<span id="nameDisplay1"></span>" —Å–æ–¥–µ—Ä–∂–∏—Ç <span id="nameLength1"></span> —Å–∏–º–≤–æ–ª–æ–≤.</p>
                <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> <span id="crispResult"></span></p>
            </div>

            <h3>–ù–µ—á–µ—Ç–∫–∞—è (Fuzzy) –ª–æ–≥–∏–∫–∞</h3>
            <p>–í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ "–¥–ª–∏–Ω–Ω–æ–µ" ‚Äî —ç—Ç–æ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –í–ö–õ/–í–´–ö–õ. –î–∞–≤–∞–π—Ç–µ –≤–≤–µ–¥–µ–º —Å—Ç–µ–ø–µ–Ω—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏.</p>
            <div class="chart-container">
                <canvas id="fuzzyChart1" width="600" height="300"></canvas>
            </div>
            <div class="result-box" id="fuzzyResult1"></div>
            
            <div class="navigation">
                <button onclick="previousStep()">‚Üê –ù–∞–∑–∞–¥</button>
                <button onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Linguistic Modifiers -->
        <div class="step-section" id="step2">
            <h2>–ú–æ–¥—É–ª—å 2: –õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã</h2>
            <p>–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –Ω–∞—Ä–µ—á–∏—è –º–µ–Ω—è—é—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É –ø–æ–Ω—è—Ç–∏—è "–¥–ª–∏–Ω–Ω–æ–µ".</p>
            
            <div class="modifier-buttons">
                <button class="modifier-btn active" onclick="applyModifier('normal')">–û–±—ã—á–Ω–æ–µ</button>
                <button class="modifier-btn" onclick="applyModifier('very')">–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ</button>
                <button class="modifier-btn" onclick="applyModifier('fairly')">–î–æ–≤–æ–ª—å–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ</button>
                <button class="modifier-btn" onclick="applyModifier('not')">–ù–µ –¥–ª–∏–Ω–Ω–æ–µ</button>
            </div>

            <div class="chart-container">
                <canvas id="modifierChart" width="600" height="300"></canvas>
            </div>

            <div class="formula" id="modifierFormula">
                –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: Œº(x)
            </div>

            <div class="navigation">
                <button onclick="previousStep()">‚Üê –ù–∞–∑–∞–¥</button>
                <button onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Fuzzy Inference -->
        <div class="step-section" id="step3">
            <h2>–ú–æ–¥—É–ª—å 3: –ù–µ—á–µ—Ç–∫–∏–π –≤—ã–≤–æ–¥</h2>
            <p><span class="highlight" id="userGreeting2"></span>, –¥–∞–≤–∞–π—Ç–µ –æ—Ü–µ–Ω–∏–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∞—Å!</p>
            
            <h3>–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–§–∞–∑–∑–∏—Ñ–∏–∫–∞—Ü–∏—è)</h3>
            <div class="input-group">
                <label>–ó–Ω–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏: <span class="slider-value" id="knowledgeValue">80</span>%</label>
                <input type="range" id="knowledgeSlider" min="0" max="100" value="80" oninput="updateSliders()">
            </div>
            <div class="input-group">
                <label>–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: <span class="slider-value" id="sentenceValue">25</span> —Å–ª–æ–≤</label>
                <input type="range" id="sentenceSlider" min="5" max="40" value="25" oninput="updateSliders()">
            </div>

            <div class="chart-container">
                <canvas id="inputChart1" width="600" height="250"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="inputChart2" width="600" height="250"></canvas>
            </div>

            <h3>–ë–∞–∑–∞ –ø—Ä–∞–≤–∏–ª</h3>
            <div id="rulesContainer"></div>

            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏</h3>
            <div class="chart-container">
                <canvas id="outputChart" width="600" height="300"></canvas>
            </div>

            <div class="navigation">
                <button onclick="previousStep()">‚Üê –ù–∞–∑–∞–¥</button>
                <button onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
            </div>
        </div>

        <!-- Step 4: Defuzzification -->
        <div class="step-section" id="step4">
            <h2>–ú–æ–¥—É–ª—å 4: –î–µ—Ñ–∞–∑–∑–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
            <p>–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–µ—á–µ—Ç–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —á–µ—Ç–∫–æ–µ —á–∏—Å–ª–æ.</p>
            
            <div class="chart-container">
                <canvas id="defuzzChart" width="600" height="300"></canvas>
            </div>

            <div class="result-box">
                <h3>–§–∏–Ω–∏—à</h3>
                <p>–î–ª—è –≤–∞—Å, <span class="highlight" id="userGreeting3"></span>, –∏—Ç–æ–≥–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç:</p>
                <p style="font-size: 2em; text-align: center; color: var(--accent); margin: 20px 0;">
                    <span id="finalComplexity">67</span> –∏–∑ 100
                </p>
            </div>

            <h3>–ü–µ—Å–æ—á–Ω–∏—Ü–∞</h3>
            <p>–ü–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</p>
            <div class="input-group">
                <label>–ó–Ω–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏: <span class="slider-value" id="sandboxKnowledge">50</span>%</label>
                <input type="range" id="sandboxKnowledgeSlider" min="0" max="100" value="50" oninput="updateSandbox()">
            </div>
            <div class="input-group">
                <label>–î–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: <span class="slider-value" id="sandboxSentence">20</span> —Å–ª–æ–≤</label>
                <input type="range" id="sandboxSentenceSlider" min="5" max="40" value="20" oninput="updateSandbox()">
            </div>
            <div class="result-box">
                <p>–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: <strong><span id="sandboxResult">50</span> –∏–∑ 100</strong></p>
            </div>

            <div class="navigation">
                <button onclick="previousStep()">‚Üê –ù–∞–∑–∞–¥</button>
                <button onclick="restart()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="info-modal" id="infoModal">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleInfo()">&times;</span>
            <h2>–û Fuzzy Linguist</h2>
            
              <p><strong>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç </strong>—Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É —á–µ—Ç–∫–æ–π –∏ –Ω–µ—á–µ—Ç–∫–æ–π –ª–æ–≥–∏–∫–æ–π:</p>
            
             <ul style="margin-left: 20px; line-height: 1.8;">
                <li><strong>–ì—Ä–∞–¥–∞—Ü–∏–∏:</strong> –≤–º–µ—Å—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π </li>
				      <li><strong>–§—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏:</strong> –ö–∞–∫ –æ–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç —á–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –∫ –º–Ω–æ–∂–µ—Å—Ç–≤–∞–º</li>
                <li><strong>–õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã:</strong> –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ä–µ—á–∏–π</li>
                <li><strong>–ù–µ—á–µ—Ç–∫–∏–π –≤—ã–≤–æ–¥:</strong> –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ—á–µ—Ç–∫–∏—Ö –ø—Ä–∞–≤–∏–ª</li>
                <li><strong>–î–µ—Ñ–∞–∑–∑–∏—Ñ–∏–∫–∞—Ü–∏—è:</strong> –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—á–µ—Ç–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —á–µ—Ç–∫–∏–µ</li>
            </ul>
            
            <h3>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</h3>
            <ol style="margin-left: 20px; line-height: 1.8;">
                <li>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –∏–º—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤</li>
                <li>–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –º–æ–¥—É–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ</li>
                <li>–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–π—Ç–µ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –∏ —Å–ª–∞–π–¥–µ—Ä–∞–º–∏</li>
                <li>–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ –≤ –∫–æ–Ω—Ü–µ</li>
            </ol>
            
            <h3>–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:</h3>
            <p><strong>–ù–µ—á–µ—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞</strong> –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä–∏—Å—É—â—É—é –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É —è–∑—ã–∫—É. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –±—É–ª–µ–≤–æ–π –ª–æ–≥–∏–∫–∏ (–∏—Å—Ç–∏–Ω–∞/–ª–æ–∂—å), –Ω–µ—á–µ—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç–µ–ø–µ–Ω—è–º–∏ –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç–∏ –æ—Ç 0 –¥–æ 1.</p>
            
            <p><strong>–ü—Ä–∏–º–µ—Ä:</strong> –ü–æ–Ω—è—Ç–∏–µ "–≤—ã—Å–æ–∫–∏–π —á–µ–ª–æ–≤–µ–∫" ‚Äî –Ω–µ—á–µ—Ç–∫–æ–µ. –ß–µ–ª–æ–≤–µ–∫ —Ä–æ—Å—Ç–æ–º 175 —Å–º –º–æ–∂–µ—Ç –±—ã—Ç—å "–Ω–µ–º–Ω–æ–≥–æ –≤—ã—Å–æ–∫–∏–º" (0.3), –∞ 190 —Å–º ‚Äî "–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–º" (0.9).</p>
            
            <h3>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã:</h3>
            <div class="formula">
                ‚Ä¢ –û—á–µ–Ω—å X: Œº(x)¬≤
                ‚Ä¢ –î–æ–≤–æ–ª—å–Ω–æ X: ‚àöŒº(x)
                ‚Ä¢ –ù–µ X: 1 - Œº(x)
            </div>
            
            <p style="margin-top: 20px; text-align: center; color: var(--text-secondary);">
                ¬© 2025 | kmp+ | CC BY-NC-SA 4.0<br>
                –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ë—Ä–ì–£ –∏–º–µ–Ω–∏ –ê.–°. –ü—É—à–∫–∏–Ω–∞      </p>
        </div>
    </div>
 <div style="position: fixed; bottom: 10px; color: #777777; right: 30px; opacity: 0.3; font-size: 14px;">kmp+</div>
    <script>
        // Global variables
        let currentStep = 0;
        let userName = '';
        let currentModifier = 'normal';

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const button = document.querySelector('.theme-toggle');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                button.textContent = 'üåô ';
            } else {
                body.setAttribute('data-theme', 'dark');
                button.textContent = '‚òÄÔ∏è ';
            }
        }

        // Info modal
        function toggleInfo() {
            const modal = document.getElementById('infoModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('infoModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Start analysis
        function startAnalysis() {
            const input = document.getElementById('userName').value.trim();
            if (!input) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }
            userName = input;
            nextStep();
            initializeStep1();
        }

        // Navigation
        function nextStep() {
            if (currentStep < 4) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgressBar();
                
                // Initialize step-specific content
                if (currentStep === 2) initializeStep2();
                if (currentStep === 3) initializeStep3();
                if (currentStep === 4) initializeStep4();
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgressBar();
            }
        }

        function restart() {
            currentStep = 0;
            document.querySelectorAll('.step-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('step0').classList.add('active');
            document.getElementById('userName').value = '';
            userName = '';
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = ((currentStep + 1) / 5) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Step 1: Initialize
        function initializeStep1() {
            const nameLength = userName.length;
            
            // Update displays
            document.getElementById('userGreeting').textContent = userName;
            document.getElementById('nameDisplay1').textContent = userName;
            document.getElementById('nameLength1').textContent = nameLength;
            
            // Crisp logic result
            const isCrispLong = nameLength > 15;
            document.getElementById('crispResult').textContent = 
                isCrispLong ? '‚úÖ –ò–°–¢–ò–ù–ê (–ò–º—è –¥–ª–∏–Ω–Ω–æ–µ)' : '‚ùå –õ–û–ñ–¨ (–ò–º—è –∫–æ—Ä–æ—Ç–∫–æ–µ)';
            
            // Draw fuzzy chart
            drawFuzzyNameChart(nameLength);
            
            // Calculate fuzzy memberships
            const memberships = calculateNameMemberships(nameLength);
            let resultHTML = `<p><strong>–ò–º—è "${userName}" (${nameLength} —Å–∏–º–≤–æ–ª–æ–≤) –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫ –Ω–∞–±–æ—Ä—É:</strong></p>`;
            resultHTML += `<p>‚Ä¢ '–ö–æ—Ä–æ—Ç–∫–æ–µ' –Ω–∞ ${(memberships.short * 100).toFixed(1)}%</p>`;
            resultHTML += `<p>‚Ä¢ '–°—Ä–µ–¥–Ω–µ–µ' –Ω–∞ ${(memberships.medium * 100).toFixed(1)}%</p>`;
            resultHTML += `<p>‚Ä¢ '–î–ª–∏–Ω–Ω–æ–µ' –Ω–∞ ${(memberships.long * 100).toFixed(1)}%</p>`;
            resultHTML += `<p><em>–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è: –í –Ω–µ—á–µ—Ç–∫–æ–π –ª–æ–≥–∏–∫–µ –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!</em></p>`;
            document.getElementById('fuzzyResult1').innerHTML = resultHTML;
        }

        // Calculate name length memberships
        function calculateNameMemberships(length) {
            const short = length <= 8 ? 1 : length <= 12 ? (12 - length) / 4 : 0;
            const medium = length <= 8 ? 0 : length <= 12 ? (length - 8) / 4 : 
                           length <= 18 ? 1 : length <= 22 ? (22 - length) / 4 : 0;
            const long = length <= 18 ? 0 : length <= 22 ? (length - 18) / 4 : 1;
            
            return { short, medium, long };
        }

        // Draw fuzzy name chart
        function drawFuzzyNameChart(userNameLength) {
            const canvas = document.getElementById('fuzzyChart1');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Set colors based on theme
            const isDark = document.body.hasAttribute('data-theme');
            const textColor = isDark ? '#ecf0f1' : '#2c3e50';
            const gridColor = isDark ? '#404040' : '#e0e0e0';
            
            // Draw axes
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, height - 30);
            ctx.lineTo(width - 20, height - 30);
            ctx.moveTo(50, height - 30);
            ctx.lineTo(50, 20);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.fillText('0', 40, height - 10);
            ctx.fillText('30', width - 30, height - 10);
            ctx.fillText('–°–∏–º–≤–æ–ª—ã', width/2 - 20, height - 5);
            ctx.fillText('1.0', 25, 25);
            ctx.fillText('0.5', 25, height/2);
            ctx.fillText('0', 30, height - 25);
            
            // Draw membership functions
            const drawMembershipFunction = (points, color, label) => {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                points.forEach((point, i) => {
                    const x = 50 + (point[0] / 30) * (width - 70);
                    const y = height - 30 - point[1] * (height - 50);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
                
                // Label
                ctx.fillStyle = color;
                ctx.font = 'bold 14px Arial';
                const labelX = points[Math.floor(points.length/2)][0];
                ctx.fillText(label, 50 + (labelX / 30) * (width - 70) - 20, 40);
            };
            
            // Define membership functions
            drawMembershipFunction([[0, 1], [8, 1], [12, 0]], '#e74c3c', '–ö–æ—Ä–æ—Ç–∫–æ–µ');
            drawMembershipFunction([[8, 0], [12, 1], [18, 1], [22, 0]], '#f39c12', '–°—Ä–µ–¥–Ω–µ–µ');
            drawMembershipFunction([[18, 0], [22, 1], [30, 1]], '#27ae60', '–î–ª–∏–Ω–Ω–æ–µ');
            
            // Draw user's name position
            const userX = 50 + (userNameLength / 30) * (width - 70);
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(userX, height - 30);
            ctx.lineTo(userX, 20);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Label for user position
            ctx.fillStyle = '#3498db';
            ctx.font = 'bold 12px Arial';
            ctx.fillText(`${userNameLength} —Å–∏–º–≤–æ–ª–æ–≤`, userX - 30, height - 35);
        }

        // Step 2: Initialize
        function initializeStep2() {
            drawModifierChart('normal');
        }

        // Apply modifier
        function applyModifier(type) {
            currentModifier = type;
            
            // Update button states
            document.querySelectorAll('.modifier-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update formula display
            const formulas = {
                'normal': '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: Œº(x)',
                'very': '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: Œº(x)¬≤ (–≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç)',
                'fairly': '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: ‚àöŒº(x) (–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å)',
                'not': '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: 1 - Œº(x) (–∏–Ω–≤–µ—Ä—Å–∏—è)'
            };
            document.getElementById('modifierFormula').textContent = formulas[type];
            
            // Redraw chart
            drawModifierChart(type);
        }

        // Draw modifier chart
        function drawModifierChart(modifier) {
            const canvas = document.getElementById('modifierChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const isDark = document.body.hasAttribute('data-theme');
            const textColor = isDark ? '#ecf0f1' : '#2c3e50';
            const gridColor = isDark ? '#404040' : '#e0e0e0';
            
            // Draw axes
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, height - 30);
            ctx.lineTo(width - 20, height - 30);
            ctx.moveTo(50, height - 30);
            ctx.lineTo(50, 20);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.fillText('0', 40, height - 10);
            ctx.fillText('30', width - 30, height - 10);
            ctx.fillText('1.0', 25, 25);
            ctx.fillText('0', 30, height - 25);
            
            // Draw original and modified functions
            const drawFunction = (modifierType, color, isDashed = false) => {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                if (isDashed) ctx.setLineDash([5, 5]);
                
                ctx.beginPath();
                for (let x = 0; x <= 30; x += 0.5) {
                    const baseValue = x <= 18 ? 0 : x <= 22 ? (x - 18) / 4 : 1;
                    let value = baseValue;
                    
                    if (modifierType === 'very') value = Math.pow(baseValue, 2);
                    else if (modifierType === 'fairly') value = Math.sqrt(baseValue);
                    else if (modifierType === 'not') value = 1 - baseValue;
                    
                    const canvasX = 50 + (x / 30) * (width - 70);
                    const canvasY = height - 30 - value * (height - 50);
                    
                    if (x === 0) ctx.moveTo(canvasX, canvasY);
                    else ctx.lineTo(canvasX, canvasY);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            };
            
            // Draw original (dashed)
            drawFunction('normal', '#95a5a6', true);
            
            // Draw modified
            const colors = {
                'normal': '#27ae60',
                'very': '#e74c3c',
                'fairly': '#f39c12',
                'not': '#9b59b6'
            };
            drawFunction(modifier, colors[modifier]);
            
            // Legend
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#95a5a6';
            ctx.fillText('–û—Ä–∏–≥–∏–Ω–∞–ª', width - 150, 40);
            ctx.fillStyle = colors[modifier];
            const labels = {
                'normal': '–î–ª–∏–Ω–Ω–æ–µ',
                'very': '–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ',
                'fairly': '–î–æ–≤–æ–ª—å–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ',
                'not': '–ù–µ –¥–ª–∏–Ω–Ω–æ–µ'
            };
            ctx.fillText(labels[modifier], width - 150, 60);
        }

        // Step 3: Initialize
        function initializeStep3() {
            document.getElementById('userGreeting2').textContent = userName;
            updateSliders();
            displayRules();
        }

        // Update sliders
        function updateSliders() {
            const knowledge = document.getElementById('knowledgeSlider').value;
            const sentence = document.getElementById('sentenceSlider').value;
            
            document.getElementById('knowledgeValue').textContent = knowledge;
            document.getElementById('sentenceValue').textContent = sentence;
            
            drawInputCharts(knowledge, sentence);
            calculateAndDisplayRules(knowledge, sentence);
            drawOutputChart(knowledge, sentence);
        }

        // Draw input charts
        function drawInputCharts(knowledge, sentenceLength) {
            // Draw knowledge chart
            drawMembershipChart('inputChart1', 
                [
                    {name: '–ù–∏–∑–∫–æ–µ', points: [[0, 1], [30, 1], [50, 0]], color: '#e74c3c'},
                    {name: '–°—Ä–µ–¥–Ω–µ–µ', points: [[30, 0], [50, 1], [70, 0]], color: '#f39c12'},
                    {name: '–í—ã—Å–æ–∫–æ–µ', points: [[50, 0], [70, 1], [100, 1]], color: '#27ae60'}
                ],
                knowledge, 100, '–ó–Ω–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ (%)');
            
            // Draw sentence length chart
            drawMembershipChart('inputChart2',
                [
                    {name: '–ö–æ—Ä–æ—Ç–∫–∏–µ', points: [[5, 1], [10, 1], [20, 0]], color: '#e74c3c'},
                    {name: '–°—Ä–µ–¥–Ω–∏–µ', points: [[10, 0], [20, 1], [30, 0]], color: '#f39c12'},
                    {name: '–î–ª–∏–Ω–Ω—ã–µ', points: [[20, 0], [30, 1], [40, 1]], color: '#27ae60'}
                ],
                sentenceLength, 40, '–î–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (—Å–ª–æ–≤–∞)');
        }

        // Generic membership chart drawer
        function drawMembershipChart(canvasId, functions, currentValue, maxX, label) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const isDark = document.body.hasAttribute('data-theme');
            const textColor = isDark ? '#ecf0f1' : '#2c3e50';
            const gridColor = isDark ? '#404040' : '#e0e0e0';
            
            // Draw axes
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, height - 30);
            ctx.lineTo(width - 20, height - 30);
            ctx.moveTo(50, height - 30);
            ctx.lineTo(50, 20);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.fillText('0', 40, height - 10);
            ctx.fillText(maxX, width - 30, height - 10);
            ctx.fillText(label, width/2 - 50, height - 5);
            ctx.fillText('1.0', 25, 25);
            ctx.fillText('0', 30, height - 25);
            
            // Draw membership functions
            functions.forEach(func => {
                ctx.strokeStyle = func.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                func.points.forEach((point, i) => {
                    const x = 50 + (point[0] / maxX) * (width - 70);
                    const y = height - 30 - point[1] * (height - 50);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
                
                // Label
                ctx.fillStyle = func.color;
                ctx.font = 'bold 14px Arial';
                const labelX = func.points[Math.floor(func.points.length/2)][0];
                ctx.fillText(func.name, 50 + (labelX / maxX) * (width - 70) - 20, 40);
            });
            
            // Draw current value line
            const valueX = 50 + (currentValue / maxX) * (width - 70);
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(valueX, height - 30);
            ctx.lineTo(valueX, 20);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#3498db';
            ctx.font = 'bold 12px Arial';
            ctx.fillText(currentValue, valueX - 10, height - 35);
        }

        // Display rules
        function displayRules() {
            const rulesContainer = document.getElementById('rulesContainer');
            const rules = [
                'IF (–ó–Ω–∞–Ω–∏–µ "–í—ã—Å–æ–∫–æ–µ") AND (–î–ª–∏–Ω–∞ "–î–ª–∏–Ω–Ω—ã–µ") THEN (–°–ª–æ–∂–Ω–æ—Å—Ç—å "–°—Ä–µ–¥–Ω—è—è")',
                'IF (–ó–Ω–∞–Ω–∏–µ "–°—Ä–µ–¥–Ω–µ–µ") AND (–î–ª–∏–Ω–∞ "–î–ª–∏–Ω–Ω—ã–µ") THEN (–°–ª–æ–∂–Ω–æ—Å—Ç—å "–í—ã—Å–æ–∫–∞—è")',
                'IF (–ó–Ω–∞–Ω–∏–µ "–í—ã—Å–æ–∫–æ–µ") AND (–î–ª–∏–Ω–∞ "–°—Ä–µ–¥–Ω–∏–µ") THEN (–°–ª–æ–∂–Ω–æ—Å—Ç—å "–ù–∏–∑–∫–∞—è")',
                'IF (–ó–Ω–∞–Ω–∏–µ "–ù–∏–∑–∫–æ–µ") AND (–î–ª–∏–Ω–∞ "–õ—é–±–∞—è") THEN (–°–ª–æ–∂–Ω–æ—Å—Ç—å "–í—ã—Å–æ–∫–∞—è")'
            ];
            
            rulesContainer.innerHTML = rules.map((rule, i) => 
                `<div class="rule-box">–ü—Ä–∞–≤–∏–ª–æ ${i + 1}: ${rule}</div>`
            ).join('');
        }

        // Calculate and display rules
        function calculateAndDisplayRules(knowledge, sentenceLength) {
            // Calculate memberships for inputs
            const knowledgeMembership = {
                low: knowledge <= 30 ? 1 : knowledge <= 50 ? (50 - knowledge) / 20 : 0,
                medium: knowledge <= 30 ? 0 : knowledge <= 50 ? (knowledge - 30) / 20 : 
                        knowledge <= 70 ? (70 - knowledge) / 20 : 0,
                high: knowledge <= 50 ? 0 : knowledge <= 70 ? (knowledge - 50) / 20 : 1
            };
            
            const sentenceMembership = {
                short: sentenceLength <= 10 ? 1 : sentenceLength <= 20 ? (20 - sentenceLength) / 10 : 0,
                medium: sentenceLength <= 10 ? 0 : sentenceLength <= 20 ? (sentenceLength - 10) / 10 :
                        sentenceLength <= 30 ? (30 - sentenceLength) / 10 : 0,
                long: sentenceLength <= 20 ? 0 : sentenceLength <= 30 ? (sentenceLength - 20) / 10 : 1
            };
            
            // Apply rules and show activation levels
            const rulesContainer = document.getElementById('rulesContainer');
            const activations = [
                {rule: 1, activation: Math.min(knowledgeMembership.high, sentenceMembership.long)},
                {rule: 2, activation: Math.min(knowledgeMembership.medium, sentenceMembership.long)},
                {rule: 3, activation: Math.min(knowledgeMembership.high, sentenceMembership.medium)},
                {rule: 4, activation: knowledgeMembership.low}
            ];
            
            const ruleElements = rulesContainer.querySelectorAll('.rule-box');
            activations.forEach((act, i) => {
                if (ruleElements[i]) {
                    const opacity = 0.3 + act.activation * 0.7;
                    ruleElements[i].style.opacity = opacity;
                    ruleElements[i].innerHTML += ` <strong>(–ê–∫—Ç–∏–≤–∞—Ü–∏—è: ${(act.activation * 100).toFixed(1)}%)</strong>`;
                }
            });
        }

        // Draw output chart
        function drawOutputChart(knowledge, sentenceLength) {
            const canvas = document.getElementById('outputChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const isDark = document.body.hasAttribute('data-theme');
            const textColor = isDark ? '#ecf0f1' : '#2c3e50';
            const gridColor = isDark ? '#404040' : '#e0e0e0';
            
            // Calculate output complexity
            const complexity = calculateComplexity(knowledge, sentenceLength);
            
            // Draw axes
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, height - 30);
            ctx.lineTo(width - 20, height - 30);
            ctx.moveTo(50, height - 30);
            ctx.lineTo(50, 20);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.fillText('0', 40, height - 10);
            ctx.fillText('100', width - 30, height - 10);
            ctx.fillText('–°–ª–æ–∂–Ω–æ—Å—Ç—å', width/2 - 30, height - 5);
            ctx.fillText('1.0', 25, 25);
            
            // Draw complexity output sets
            const sets = [
                {name: '–ù–∏–∑–∫–∞—è', points: [[0, 1], [30, 1], [50, 0]], color: '#27ae60'},
                {name: '–°—Ä–µ–¥–Ω—è—è', points: [[30, 0], [50, 1], [70, 0]], color: '#f39c12'},
                {name: '–í—ã—Å–æ–∫–∞—è', points: [[50, 0], [70, 1], [100, 1]], color: '#e74c3c'}
            ];
            
            sets.forEach(set => {
                ctx.strokeStyle = set.color;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.3;
                ctx.beginPath();
                set.points.forEach((point, i) => {
                    const x = 50 + (point[0] / 100) * (width - 70);
                    const y = height - 30 - point[1] * (height - 50);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
                ctx.globalAlpha = 1;
                
                // Label
                ctx.fillStyle = set.color;
                ctx.font = 'bold 14px Arial';
                const labelX = set.points[Math.floor(set.points.length/2)][0];
                ctx.fillText(set.name, 50 + (labelX / 100) * (width - 70) - 20, 40);
            });
            
            // Draw result line
            const resultX = 50 + (complexity / 100) * (width - 70);
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(resultX, height - 30);
            ctx.lineTo(resultX, 20);
            ctx.stroke();
            
            ctx.fillStyle = '#3498db';
            ctx.font = 'bold 14px Arial';
            ctx.fillText(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${complexity}`, resultX - 30, height - 35);
        }

        // Calculate complexity
        function calculateComplexity(knowledge, sentenceLength) {
            // Simple weighted average for demonstration
            const knowledgeFactor = (100 - knowledge) * 0.6;
            const sentenceFactor = sentenceLength * 1.5;
            const complexity = Math.min(100, Math.max(0, knowledgeFactor + sentenceFactor));
            return Math.round(complexity);
        }

        // Step 4: Initialize
        function initializeStep4() {
            document.getElementById('userGreeting3').textContent = userName;
            const knowledge = document.getElementById('knowledgeSlider').value;
            const sentence = document.getElementById('sentenceSlider').value;
            const complexity = calculateComplexity(knowledge, sentence);
            
            document.getElementById('finalComplexity').textContent = complexity;
            drawDefuzzificationChart(complexity);
        }

        // Draw defuzzification chart
        function drawDefuzzificationChart(complexity) {
            const canvas = document.getElementById('defuzzChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const isDark = document.body.hasAttribute('data-theme');
            const textColor = isDark ? '#ecf0f1' : '#2c3e50';
            const gridColor = isDark ? '#404040' : '#e0e0e0';
            
            // Draw axes
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, height - 30);
            ctx.lineTo(width - 20, height - 30);
            ctx.moveTo(50, height - 30);
            ctx.lineTo(50, 20);
            ctx.stroke();
            
            // Draw fuzzy output area
            ctx.fillStyle = 'rgba(52, 152, 219, 0.3)';
            ctx.beginPath();
            ctx.moveTo(50, height - 30);
            
            // Simulate fuzzy output shape
            for (let x = 0; x <= 100; x++) {
                const membership = Math.exp(-Math.pow((x - complexity) / 20, 2));
                const canvasX = 50 + (x / 100) * (width - 70);
                const canvasY = height - 30 - membership * (height - 100);
                ctx.lineTo(canvasX, canvasY);
            }
            
            ctx.lineTo(width - 20, height - 30);
            ctx.closePath();
            ctx.fill();
            
            // Draw center of gravity
            const cogX = 50 + (complexity / 100) * (width - 70);
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(cogX, height - 30);
            ctx.lineTo(cogX, 20);
            ctx.stroke();
            
            // Draw COG marker
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(cogX, height/2, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // Labels
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.fillText('0', 40, height - 10);
            ctx.fillText('100', width - 30, height - 10);
            ctx.fillText('–°–ª–æ–∂–Ω–æ—Å—Ç—å', width/2 - 30, height - 5);
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('–¶–µ–Ω—Ç—Ä —Ç—è–∂–µ—Å—Ç–∏', cogX - 40, height/2 - 20);
            ctx.fillText(`${complexity}`, cogX - 10, height - 35);
        }

        // Sandbox update
        function updateSandbox() {
            const knowledge = document.getElementById('sandboxKnowledgeSlider').value;
            const sentence = document.getElementById('sandboxSentenceSlider').value;
            
            document.getElementById('sandboxKnowledge').textContent = knowledge;
            document.getElementById('sandboxSentence').textContent = sentence;
            
            const complexity = calculateComplexity(knowledge, sentence);
            document.getElementById('sandboxResult').textContent = complexity;
        }

        // Initialize on load
        window.onload = function() {
            updateProgressBar();
        };
    </script>
</body>
</html>